# Sending

<!--@include: @/_snippets/example-links/gql.md-->

::: tip Read Static First
This guide builds on [Static](/guides/documents/static/building). Read that first to understand document building - this guide focuses on how to **send** documents with a client instance.
:::

## Overview

Once you have a Graffle client instance, the `client.gql()` method sends GraphQL documents. This is the **instance API** - it requires a configured client.

**What it accepts:**

- All the same inputs as the [static builder](/guides/documents/static/building) (strings, objects)
- Pre-built documents from the static builder
- Legacy types like `DocumentNode` (from `graphql` package)

**What it returns:**

- A **Document Sender** - an object with typed methods for executing operations

```ts
import { Graffle } from 'graffle'

const client = Graffle.create().transport({
  url: 'https://api.example.com/graphql',
})

// Send a GraphQL string
const sender = client.gql(`
  query getPokemon($name: String!) {
    pokemonByName(name: $name) { name hp }
  }
`)

// Execute using the operation name
const pokemon = await sender.getPokemon({ name: 'Pikachu' })
```

## What Can Be Sent

The `client.gql()` method accepts the same inputs as the static builder, plus pre-built documents and legacy types:

:::tabs
== string

```ts
const sender = client.gql(`query { pokemons { name } }`)
await sender.$send()
```

== object

```ts
const sender = client.gql({
  query: {
    getPokemons: {
      pokemons: { name: true, hp: true },
    },
  },
})
await sender.getPokemons()
```

== pre-built

```ts
import { Graffle } from './graffle/_.js'

const doc = Graffle.query.pokemons({ name: true, hp: true })

const client = Graffle.create()
await client.gql(doc).$send()
```

== legacy

```ts
import { parse } from 'graphql'

const doc = parse(`
  query pokemonByName($name: String!) {
    pokemonByName(name: $name) { name hp }
  }
`)
await client.gql(doc).$send({ name: 'Pikachu' })

import { type TypedQueryDocumentNode } from 'graphql'

type PokemonDocument = TypedQueryDocumentNode<
  { pokemonByName: { name: string; hp: number } },
  { name: string }
>

const typedDoc = parse(`
  query pokemonByName($name: String!) {
    pokemonByName(name: $name) { name hp }
  }
`) as PokemonDocument

const result = await client.gql(typedDoc).$send({ name: 'Pikachu' })

import { type TypedDocument } from 'graffle'

type PokemonQuery = TypedDocument.String<
  { pokemonByName: { name: string; hp: number } },
  { name: string }
>

const data = await client.gql<PokemonQuery>(`
  query pokemonByName($name: String!) {
    pokemonByName(name: $name) { name hp }
  }
`).$send({ name: 'Pikachu' })
```

**Type Safety Options:**

- **`DocumentNode`** - No type safety, runtime-only
- **`TypedQueryDocumentNode`** - Type-safe document nodes (from `graphql` package)
- **`TypedDocument.String`** - Type-safe string documents (Graffle's type)

These types are typically generated by tools like [GraphQL Code Generator](https://the-guild.dev/graphql/codegen). For native type safety without code generation, use the [static builder](/guides/documents/static) instead.

:::

## Sender Interface

When you call `client.gql()`, you get back a **Document Sender** with two ways to execute operations:

### Operation Methods

Each named operation in your document becomes a typed method:

:::tabs
== string

```ts
const sender = client.gql(`
  query getPokemon($name: String!) {
    pokemonByName(name: $name) { name hp }
  }
  query getPokemons {
    pokemons { name }
  }
`)

const pokemon = await sender.getPokemon({ name: 'Pikachu' })
const pokemons = await sender.getPokemons()
```

== object

```ts
import { $ } from 'graffle'

const sender = client.gql({
  query: {
    getPokemon: {
      pokemonByName: {
        $: { name: $('name').required() },
        name: true,
        hp: true,
      },
    },
    getPokemons: {
      pokemons: {
        name: true,
      },
    },
  },
})

const pokemon = await sender.getPokemon({ name: 'Pikachu' })
const pokemons = await sender.getPokemons()
```

:::

**How variables work:**

- **Required variables** - Must be provided: `.getPokemon({ name: 'Pikachu' })`
- **Optional variables** - Can be omitted: `.getPokemons()` or `.getPokemons({ filter: { type: 'FIRE' } })`
- **No variables** - Call with no arguments: `.getPokemons()`

TypeScript enforces this automatically based on your document.

### Static Send Method

For runtime flexibility, use `.$send()`:

:::tabs
== string

```ts
await client.gql('query getPokemons { pokemons { name } }').$send()
await client.gql(
  'query getPokemon($name: String!) { pokemonByName(name: $name) { hp } }',
).$send(
  { name: 'Pikachu' },
)

const sender = client.gql(`
  query getPokemon($name: String!) { pokemonByName(name: $name) { name hp } }
  query getPokemons { pokemons { name } }
`)
await sender.$send('getPokemon', { name: 'Pikachu' })
await sender.$send('getPokemons')
```

== object

```ts
import { $ } from 'graffle'

await client.gql({
  query: {
    getPokemons: {
      pokemons: { name: true },
    },
  },
}).$send()

await client.gql({
  query: {
    getPokemon: {
      pokemonByName: {
        $: { name: $('name').required() },
        hp: true,
      },
    },
  },
}).$send({ name: 'Pikachu' })

const sender = client.gql({
  query: {
    getPokemon: {
      pokemonByName: {
        $: { name: $('name').required() },
        name: true,
        hp: true,
      },
    },
    getPokemons: {
      pokemons: { name: true },
    },
  },
})
await sender.$send('getPokemon', { name: 'Pikachu' })
await sender.$send('getPokemons')
```

:::

### Variables

The relationship between operation names and variables:

:::tabs
== string

```ts
const sender = client.gql(`
  query pokemonDetails($name: String!, $includeStats: Boolean = false) {
    pokemonByName(name: $name) {
      name
      hp @include(if: $includeStats)
      attack @include(if: $includeStats)
    }
  }
`)

await sender.pokemonDetails({
  name: 'Pikachu',
  includeStats: true,
})
```

== object

```ts
import { $ } from 'graffle'

const sender = client.gql({
  query: {
    pokemonDetails: {
      pokemonByName: {
        $: {
          name: $('name').required(),
          includeStats: $('includeStats').optional().default(false),
        },
        name: true,
        hp: {
          $include: $('includeStats'),
        },
        attack: {
          $include: $('includeStats'),
        },
      },
    },
  },
})

await sender.pokemonDetails({
  name: 'Pikachu',
  includeStats: true,
})
```

:::

**Anonymous operations** (without names) only support `.$send()`:

:::tabs
== string

```ts
const sender = client.gql(`query { pokemons { name } }`)
await sender.$send()
```

== object

```ts
const sender = client.gql({
  query: {
    pokemons: { name: true },
  },
})
await sender.$send()
```

:::
