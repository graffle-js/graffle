const e=(e,t)=>{const r="object"==typeof t.output?.envelope?{enabled:!0,...t.output.envelope}:"boolean"==typeof t.output?.envelope?{enabled:t.output.envelope}:void 0,n={name:t.name??e?.name??Se,schemaMap:t.schemaMap??e.schemaMap,output:{defaults:{errorChannel:t.output?.defaults?.errorChannel??e.output.defaults.errorChannel},envelope:{enabled:r?.enabled??e.output.envelope.enabled,errors:{execution:r?.errors?.execution??e.output.envelope.errors.execution,other:r?.errors?.other??e.output.envelope.errors.other,schema:r?.errors?.schema??e.output.envelope.errors.schema}},errors:{execution:t.output?.errors?.execution??e.output.errors.execution,other:t.output?.errors?.other??e.output.errors.other,schema:t.output?.errors?.schema??e.output.errors.schema}}};return be.withTypeLevel({...e,...n})},t=(e,t)=>"default"===e.errors[t]?e.defaults.errorChannel:e.errors[t],r={defaults:{errorChannel:"throw"},envelope:{enabled:!1,errors:{execution:!0,other:!1}},errors:{execution:"default",other:"default"}},n=e=>{const t={discriminant:e.discriminant,inputDefaults:e.inputDefaults,steps:{}},r={type:t,config:()=>r,defaults:e=>(t.inputDefaults=e,r),configInit:()=>r,stepWithExtendedInput:()=>r.step,step:(e,n)=>(t.steps[e]={name:e,...n},r)};return r};var o;!function(e){e.create=e=>{let t=e.steps;e.overloads.length>0&&(t=t.map((t=>{const r=e.overloads.map((e=>{const r=e.steps[t.name];return r?{...r,discriminant:e.discriminant}:null})).filter((e=>null!==e));return{name:t.name,run:(...e)=>{const n=e[0],o=r.find((e=>n[e.discriminant[0]]===e.discriminant[1]));return o?o.run(...e):t.run(...e)},slots:{...t.slots,...r.reduce(((e,t)=>({...e,...t.slots})),{})}}})));const r=(e=>new Map(e.map((e=>[e.name,e]))))(t);return{...e,steps:t,stepsIndex:r}}}(o||(o={}));const s=e=>e instanceof Error?e:Error(e+""),i=e=>{throw Error("Unhandled case: "+e)},a=e=>{let t,r,n=!1;return{promise:new Promise(((e,n)=>{t=e,r=n})),isResolved:()=>n,resolve:r=>{if(n=!0,e?.strict&&n)throw Error("Deferred is already resolved. Attempted to resolve with: "+JSON.stringify(r));t(r)},reject:e=>r(e)}},u=(...e)=>{globalThis.process?.env?.DEBUG&&console.log(...e)},c=(...e)=>(...t)=>{u(...e,...t)};new Proxy({},{get:()=>e=>e});const l=e=>"string"==typeof e,p=e=>e,d=e=>{const t={type:e,input:()=>t,done:()=>o.create(e),stepWithRunnerType:()=>t.step,step:(...t)=>{const r="string"==typeof t[0]?{name:t[0],run:m,...t[1]}:{run:m,...t[0]};return d({...e,steps:[...e.steps,r]})},use:t=>d({...e,overloads:[...e.overloads,...t.type.overloads]}),overload:t=>{const r=t({create:n});return e.overloads.push(r.type),d(e)}};return t},m=e=>e.input;class f extends Error{context;cause;name="ContextualError";constructor(e,t={},r=void 0){super(e,r),this.context=t,this.cause=r}}class h extends f{errors;name="ContextualAggregateError";constructor(e,t,r){super(e,t,void 0),this.errors=r}}const v=/^(?:(?<async>async)\s+)?(?:function\s+)?(?:(?<name>[A-z_0-9]+)\s*)?\((?<parameters>[^)]*)\)\s*(?:=>\s*(?<bodyExpression>[^\s{].*)|(?:=>\s*)?{(?<bodyStatement>.*)})$/s,y=/(?<destructured>\{[^}]+\})|(?<name>[A-z_][A-z_0-9]*)/gs,E=/(?<name>[A-z_][A-z_0-9]*)(?::[^},]+)?/gs;class N extends f{constructor(e){super("Interceptor must destructure the first parameter passed to it and select exactly one step.",e)}}const g="multipleParameters",k="noParameters",I="notDestructured",T="destructuredWithoutEntryHook",x="multipleDestructuredHookNames",w="invalidDestructuredHookNames",S=Symbol("resultEnvelope"),b=e=>({[S]:S,result:e});var C;!function(e){e.create=(e,t)=>(t.input=e,t)}(C||(C={}));const O=e=>({...e,currentChunk:a()}),D=async({pipeline:e,name:t,done:r,inputOriginalOrFromExtension:n,previousStepsCompleted:o,interceptorsStack:u,nextInterceptorsStack:l,asyncErrorDeferred:p,customSlots:d})=>{const m=c(`step ${t}:`);m("advance to next interceptor");const[h,...v]=u;if(!(0===v.length)&&h?.retrying&&r({type:"error",source:"user",extensionName:h.name,hookName:t,error:new f("Only the last extension can retry hooks.",{extensionsAfter:v.map((e=>({name:e.name})))})}),h){const u=c(`hook ${t}: extension ${h.name}:`),y=a();u("start");let E=!1;const N=C.create(n,(s=>{u("extension calls this hook",s);const i=s?.input??n,c={...d,...s?.using};if(y.isResolved()){if(h.retrying){if(E){u("execute branch: retry");const i=O(h);return D({pipeline:e,name:t,done:r,previousStepsCompleted:o,inputOriginalOrFromExtension:n,asyncErrorDeferred:p,interceptorsStack:[i],nextInterceptorsStack:l,customSlots:c}),i.currentChunk.promise.then((async e=>{const r=e[t];if(!r)throw Error("Hook not found in envelope: "+t);return await r({...s,input:s?.input??n})}))}return p.resolve({type:"error",source:"extension",interceptorName:h.name,hookName:t,error:new f("Only after failure can a hook be called again by a retrying extension.",{hookName:t,extensionName:h.name})}),a().promise}return p.resolve({type:"error",source:"extension",interceptorName:h.name,hookName:t,error:new f("Only a retrying extension can retry hooks.",{hookName:t,extensionsAfter:v.map((e=>({name:e.name})))})}),a().promise}{const n=O(h),s=[...l,n];return y.resolve(!0),D({pipeline:e,name:t,done:r,previousStepsCompleted:o,asyncErrorDeferred:p,inputOriginalOrFromExtension:i,interceptorsStack:v,nextInterceptorsStack:s,customSlots:c}),n.currentChunk.promise.then((e=>(e instanceof Error&&(u("received hook error"),E=!0),e)))}}));u("advance with envelope");const g={[t]:N};h.currentChunk.resolve(g),m("start race between extension returning or invoking next hook");const{branch:k,result:I}=await Promise.race([y.promise.then((e=>({branch:"hookInvoked",result:e}))).catch((e=>({branch:"hookInvokedButThrew",result:e}))),h.body.promise.then((e=>({branch:"extensionReturned",result:e}))).catch((e=>({branch:"extensionThrew",result:e})))]);switch(k){case"hookInvoked":return void u("invoked next hook (or retrying extension got error pushed through)");case"extensionReturned":return u("extension returned"),void(I===g?D({pipeline:e,name:t,done:r,previousStepsCompleted:o,inputOriginalOrFromExtension:n,asyncErrorDeferred:p,interceptorsStack:v,nextInterceptorsStack:l,customSlots:d}):r({type:"shortCircuited",result:I}));case"extensionThrew":return u("extension threw"),void r({type:"error",hookName:t,source:"extension",error:s(I),interceptorName:h.name});case"hookInvokedButThrew":return u("hook error"),void r({type:"error",hookName:t,source:"implementation",error:s(I)});default:throw i(k)}}else{m("no more interceptors to advance, run implementation");const i=e.stepsIndex.get(t);if(!i)throw new f("Implementation not found for step name "+t,{hookName:t});let a;try{const e={...i.slots,...d};a=await i.run(n,e,o)}catch(e){m("implementation error");const n=l[l.length-1];return void(n&&n.retrying?n.currentChunk.resolve(s(e)):r({type:"error",hookName:t,source:"implementation",error:s(e)}))}m("completed"),r({type:"completed",result:a,effectiveInput:n,nextExtensionsStack:l})}},A=async({pipeline:e,stepsToProcess:t,originalInputOrResult:r,interceptorsStack:n,asyncErrorDeferred:o,previousStepsCompleted:s})=>{const[c,...l]=t;if(!c){u("pipeline: ending");const e=await _({interceptorsStack:n,result:r});return u("pipeline: returning"),b(e)}u(`hook ${c.name}: start`);const p=a({strict:!1});D({pipeline:e,name:c.name,done:p.resolve,inputOriginalOrFromExtension:r,previousStepsCompleted:s,interceptorsStack:n,asyncErrorDeferred:o,customSlots:{},nextInterceptorsStack:[]});const d=await Promise.race([p.promise,o.promise]);switch(d.type){case"completed":{const{result:t,effectiveInput:r,nextExtensionsStack:n}=d,i={...s,[c.name]:{input:r}};return await A({pipeline:e,stepsToProcess:l,originalInputOrResult:t,interceptorsStack:n,previousStepsCompleted:i,asyncErrorDeferred:o})}case"shortCircuited":{u("signal: shortCircuited");const{result:e}=d;return b(e)}case"error":{if(u("signal: error"),e.config.passthroughErrorWith?.(d))return d.error;if(e.config.passthroughErrorInstanceOf.some((e=>d.error instanceof e)))return d.error;const t=o.isResolved();switch(d.source){case"extension":{const e="anonymous"===d.interceptorName?" (use named functions to improve this error message)":"";return new f(t?`There was an error in the interceptor "${d.interceptorName}"${e}.`:`There was an error in the interceptor "${d.interceptorName}"${e} while running hook "${d.hookName}".`,{hookName:d.hookName,source:d.source,interceptorName:d.interceptorName},d.error)}case"implementation":return new f(`There was an error in the core implementation of hook "${d.hookName}".`,{hookName:d.hookName,source:d.source},d.error);case"user":return d.error;default:throw i(d)}}default:throw i(d)}},_=async({interceptorsStack:e,result:t})=>{const[r,...n]=e;if(!r)return t;u(`interceptor ${r.name}: end`),r.currentChunk.resolve(t);const o=await r.body.promise;return await _({interceptorsStack:n,result:o})},F=e=>async t=>{const{initialInput:r,interceptors:n=[],retryingInterceptor:o}=t??{};var s;const i=(o?[...n,(s=o,{retrying:!0,run:s})]:n).map((t=>q(e,t))),[u,c]=(e=>{const[t,r]=(e=>{const t=[],r=[];for(const n of e)n instanceof Error?t.push(n):r.push(n);return[r,t]})(e);return[t,r.length>0?new h("One or more extensions are invalid.",{},r):null]})(i);if(c)return c;const l=a({strict:!1}),p=await A({pipeline:e,stepsToProcess:e.steps,originalInputOrResult:r,interceptorsStack:u,asyncErrorDeferred:l,previousStepsCompleted:{}});return p instanceof Error?p:(e=>({value:e}))(p.result)},q=(e,t)=>{const r=a(),n=a(),o="function"==typeof t?t:t.run,s="function"!=typeof t&&t.retrying,u=async e=>{try{const t=await o(e);n.resolve(t)}catch(e){n.reject(e)}},c=o.name||"anonymous";switch(e.config.entrypointSelectionMode){case"off":return r.promise.then(u),{name:c,entrypoint:e.steps[0]?.name,body:n,currentChunk:r};case"optional":case"required":{const t=((e,t)=>{const r=e.stepsIndex,n=(e=>{const t=(""+e).match(v)?.groups;if(!t)throw Error("Could not extract groups from function.");const r=t.bodyStatement??t.bodyExpression;if(void 0===r)throw Error("Could not extract body from function.");const n=[];if(t.parameters){const e=[...t.parameters.matchAll(y)].map((e=>{const t=e.groups?.destructured?"destructured":e.groups?.name?"name":null;switch(t){case"destructured":return{type:t,names:[...e.groups.destructured.matchAll(E)].map((e=>{const t=e.groups.name;if(void 0===t)throw Error("Could not extract name from destructured parameter.");return t}))};case"name":return{type:t,value:e.groups.name};case null:throw Error("Could not determine type of parameter.");default:throw i(t)}}));n.push(...e)}return{body:r,parameters:n}})(t);if(n.parameters.length>1)return new N({issue:g});const o=n.parameters[0];if(o){if("name"===o.type)return new N({issue:I});{if(0===o.names.length)return new N({issue:T});const e=o.names.filter((e=>r.has(e)));if(e.length>1)return new N({issue:x});const t=e[0];return t?r.get(t)||new N({issue:T}):new N({issue:w})}}return new N({issue:k})})(e,o);if(t instanceof Error)return"required"===e.config.entrypointSelectionMode?t:(r.promise.then(u),{name:c,entrypoint:e.steps[0]?.name,body:n,currentChunk:r});const a=[];for(const r of e.steps){if(r===t)break;a.push(r.name)}const l=a.map((e=>R(e)));let p=r.promise;for(const e of l)p=p.then(e);return p.then(u),{retrying:s,name:c,entryStep:t,body:n,currentChunk:r}}default:throw i(e.config.entrypointSelectionMode)}},R=e=>async t=>{const r=t[e];if(!r)throw new f("Hook not found in hook envelope",{hookName:e});return await r({input:r.input})};class P extends Error{constructor(e,t,r,n,o,s,i){super(e),this.name="GraphQLError",this.message=e,o&&(this.path=o),t&&(this.nodes=Array.isArray(t)?t:[t]),r&&(this.source=r),n&&(this.positions=n),s&&(this.originalError=s);var a=i;if(!a&&s){var u=s.extensions;u&&"object"==typeof u&&(a=u)}this.extensions=a||{}}toJSON(){return{...this,message:this.message}}toString(){return this.message}get[Symbol.toStringTag](){return"GraphQLError"}}var V,j;function M(e){return new P(`Syntax Error: Unexpected token at ${j} in ${e}`)}function L(e){if(e.lastIndex=j,e.test(V))return V.slice(j,j=e.lastIndex)}var U=/ +(?=[^\s])/y;function $(e){for(var t=e.split("\n"),r="",n=0,o=0,s=t.length-1,i=0;t.length>i;i++)U.lastIndex=0,U.test(t[i])&&(!i||n&&U.lastIndex>=n||(n=U.lastIndex),o=o||i,s=i);for(var a=o;s>=a;a++)a!==o&&(r+="\n"),r+=t[a].slice(n).replace(/\\"""/g,'"""');return r}function B(){for(var e=0|V.charCodeAt(j++);9===e||10===e||13===e||32===e||35===e||44===e||65279===e;e=0|V.charCodeAt(j++))if(35===e)for(;10!==(e=V.charCodeAt(j++))&&13!==e;);j--}var Y,G=/[_A-Za-z]\w*/y,H=RegExp("(?:(null|true|false)|\\$("+G.source+')|(-?\\d+)((?:\\.\\d+)?[eE][+-]?\\d+|\\.\\d+)?|("""(?:"""|(?:[\\s\\S]*?[^\\\\])"""))|("(?:"|[^\\r\\n]*?[^\\\\]"))|('+G.source+"))","y"),J=((Y=J||{})[Y.Const=1]="Const",Y[Y.Var=2]="Var",Y[Y.Int=3]="Int",Y[Y.Float=4]="Float",Y[Y.BlockString=5]="BlockString",Y[Y.String=6]="String",Y[Y.Enum=7]="Enum",Y),z=/\\/;function W(e){var t,r;if(H.lastIndex=j,91===V.charCodeAt(j)){j++,B();for(var n=[];93!==V.charCodeAt(j);)n.push(W(e));return j++,B(),{kind:"ListValue",values:n}}if(123===V.charCodeAt(j)){j++,B();for(var o=[];125!==V.charCodeAt(j);){if(null==(t=L(G)))throw M("ObjectField");if(B(),58!==V.charCodeAt(j++))throw M("ObjectField");B(),o.push({kind:"ObjectField",name:{kind:"Name",value:t},value:W(e)})}return j++,B(),{kind:"ObjectValue",fields:o}}if(null!=(r=H.exec(V))){if(j=H.lastIndex,B(),null!=(t=r[J.Const]))return"null"===t?{kind:"NullValue"}:{kind:"BooleanValue",value:"true"===t};if(null!=(t=r[J.Var])){if(e)throw M("Variable");return{kind:"Variable",name:{kind:"Name",value:t}}}var s;if(null!=(t=r[J.Int]))return null!=(s=r[J.Float])?{kind:"FloatValue",value:t+s}:{kind:"IntValue",value:t};if(null!=(t=r[J.BlockString]))return{kind:"StringValue",value:$(t.slice(3,-3)),block:!0};if(null!=(t=r[J.String]))return{kind:"StringValue",value:z.test(t)?JSON.parse(t):t.slice(1,-1),block:!1};if(null!=(t=r[J.Enum]))return{kind:"EnumValue",value:t}}throw M("Value")}function X(e){if(40===V.charCodeAt(j)){var t,r=[];j++,B();do{if(null==(t=L(G)))throw M("Argument");if(B(),58!==V.charCodeAt(j++))throw M("Argument");B(),r.push({kind:"Argument",name:{kind:"Name",value:t},value:W(e)})}while(41!==V.charCodeAt(j));return j++,B(),r}}function Q(e){if(64===V.charCodeAt(j)){var t,r=[];do{if(j++,null==(t=L(G)))throw M("Directive");B(),r.push({kind:"Directive",name:{kind:"Name",value:t},arguments:X(e)})}while(64===V.charCodeAt(j));return r}}function Z(){for(var e,t=0;91===V.charCodeAt(j);)t++,j++,B();if(null==(e=L(G)))throw M("NamedType");B();var r={kind:"NamedType",name:{kind:"Name",value:e}};do{if(33===V.charCodeAt(j)&&(j++,B(),r={kind:"NonNullType",type:r}),t){if(93!==V.charCodeAt(j++))throw M("NamedType");B(),r={kind:"ListType",type:r}}}while(t--);return r}var K=RegExp("(?:(\\.{3})|("+G.source+"))","y"),ee=function(e){return e[e.Spread=1]="Spread",e[e.Name=2]="Name",e}(ee||{});function te(){var e,t,r=[];do{if(K.lastIndex=j,null==(t=K.exec(V)))throw M("SelectionSet");if(j=K.lastIndex,null!=t[ee.Spread]){B();var n=L(G);if(null!=n&&"on"!==n)B(),r.push({kind:"FragmentSpread",name:{kind:"Name",value:n},directives:Q(!1)});else{if(B(),"on"===n){if(null==(n=L(G)))throw M("NamedType");B()}var o=Q(!1);if(123!==V.charCodeAt(j++))throw M("InlineFragment");B(),r.push({kind:"InlineFragment",typeCondition:n?{kind:"NamedType",name:{kind:"Name",value:n}}:void 0,directives:o,selectionSet:te()})}}else if(null!=(e=t[ee.Name])){var s=void 0;if(B(),58===V.charCodeAt(j)){if(j++,B(),s=e,null==(e=L(G)))throw M("Field");B()}var i=X(!1);B();var a=Q(!1),u=void 0;123===V.charCodeAt(j)&&(j++,B(),u=te()),r.push({kind:"Field",alias:s?{kind:"Name",value:s}:void 0,name:{kind:"Name",value:e},arguments:i,directives:a,selectionSet:u})}}while(125!==V.charCodeAt(j));return j++,B(),{kind:"SelectionSet",selections:r}}function re(){var e,t;if(null==(e=L(G)))throw M("FragmentDefinition");if(B(),"on"!==L(G))throw M("FragmentDefinition");if(B(),null==(t=L(G)))throw M("FragmentDefinition");B();var r=Q(!1);if(123!==V.charCodeAt(j++))throw M("FragmentDefinition");return B(),{kind:"FragmentDefinition",name:{kind:"Name",value:e},typeCondition:{kind:"NamedType",name:{kind:"Name",value:t}},directives:r,selectionSet:te()}}var ne,oe=/(?:query|mutation|subscription|fragment)/y;function se(e){var t,r,n;if(e&&(B(),t=L(G),r=function(){if(B(),40===V.charCodeAt(j)){var e,t=[];j++,B();do{if(36!==V.charCodeAt(j++))throw M("Variable");if(null==(e=L(G)))throw M("Variable");if(B(),58!==V.charCodeAt(j++))throw M("VariableDefinition");B();var r=Z(),n=void 0;61===V.charCodeAt(j)&&(j++,B(),n=W(!0)),B(),t.push({kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:e}},type:r,defaultValue:n,directives:Q(!0)})}while(41!==V.charCodeAt(j));return j++,B(),t}}(),n=Q(!1)),123===V.charCodeAt(j))return j++,B(),{kind:"OperationDefinition",operation:e||"query",name:t?{kind:"Name",value:t}:void 0,variableDefinitions:r,directives:n,selectionSet:te()}}!function(e){e.NAME="Name",e.DOCUMENT="Document",e.OPERATION_DEFINITION="OperationDefinition",e.VARIABLE_DEFINITION="VariableDefinition",e.SELECTION_SET="SelectionSet",e.FIELD="Field",e.ARGUMENT="Argument",e.FRAGMENT_SPREAD="FragmentSpread",e.INLINE_FRAGMENT="InlineFragment",e.FRAGMENT_DEFINITION="FragmentDefinition",e.VARIABLE="Variable",e.INT="IntValue",e.FLOAT="FloatValue",e.STRING="StringValue",e.BOOLEAN="BooleanValue",e.NULL="NullValue",e.ENUM="EnumValue",e.LIST="ListValue",e.OBJECT="ObjectValue",e.OBJECT_FIELD="ObjectField",e.DIRECTIVE="Directive",e.NAMED_TYPE="NamedType",e.LIST_TYPE="ListType",e.NON_NULL_TYPE="NonNullType",e.SCHEMA_DEFINITION="SchemaDefinition",e.OPERATION_TYPE_DEFINITION="OperationTypeDefinition",e.SCALAR_TYPE_DEFINITION="ScalarTypeDefinition",e.OBJECT_TYPE_DEFINITION="ObjectTypeDefinition",e.FIELD_DEFINITION="FieldDefinition",e.INPUT_VALUE_DEFINITION="InputValueDefinition",e.INTERFACE_TYPE_DEFINITION="InterfaceTypeDefinition",e.UNION_TYPE_DEFINITION="UnionTypeDefinition",e.ENUM_TYPE_DEFINITION="EnumTypeDefinition",e.ENUM_VALUE_DEFINITION="EnumValueDefinition",e.INPUT_OBJECT_TYPE_DEFINITION="InputObjectTypeDefinition",e.DIRECTIVE_DEFINITION="DirectiveDefinition",e.SCHEMA_EXTENSION="SchemaExtension",e.SCALAR_TYPE_EXTENSION="ScalarTypeExtension",e.OBJECT_TYPE_EXTENSION="ObjectTypeExtension",e.INTERFACE_TYPE_EXTENSION="InterfaceTypeExtension",e.UNION_TYPE_EXTENSION="UnionTypeExtension",e.ENUM_TYPE_EXTENSION="EnumTypeExtension",e.INPUT_OBJECT_TYPE_EXTENSION="InputObjectTypeExtension"}(ne||(ne={}));const ie="query",ae=e=>"object"==typeof e&&null!==e&&"kind"in e&&"OperationDefinition"===e.kind,ue=e=>"NamedType"===e.kind?e:ue(e.type),ce=e=>{for(const t of e.query.definitions){const r=ae(t)?t:null;if(!e.operationName)return r;if(r?.name?.value===e.operationName)return r}return null},le=RegExp(`^\\b(${Object.values(Object.freeze({__proto__:null,MUTATION:"mutation",QUERY:ie,SUBSCRIPTION:"subscription"})).join("|")})\\b`),pe=e=>{const t=e;return l(t)?function(e){return j=0,function(e){var t,r;B();var n,o=[];do{if("fragment"===(t=L(oe)))B(),o.push(re());else{if(null==(r=se(t)))throw M("Document");o.push(r)}}while(e.length>j);return{kind:"Document",definitions:o,set loc(e){n=e},get loc(){return n||(n={start:0,end:e.length,startToken:void 0,endToken:void 0,source:{body:e,name:"graphql.web",locationOffset:{line:1,column:1}}}),n}}}(V="string"==typeof e.body?e.body:e)}(t):t},de=e=>{const t=pe(e.query);if("operation"in e){const r=ce({...e,query:pe(e.query)});return{...e,operation:r,query:t}}return{...e,query:t}},me=(e,t)=>({kind:"Scalar",name:e,codec:t}),fe=me("String",{encode:e=>e,decode:e=>e});var he;!function(e){e.empty={map:{}}}(he||(he={}));const ve=(e,t)=>e[t]||fe,ye=(e,t)=>null===t?null:Array.isArray(t)?t.map((t=>ye(e,t))):e(t),Ee=e=>"object"==typeof e&&null!==e&&"codec"in e&&"object"==typeof e.codec,Ne=e=>l(e),ge=Ee,ke=e=>{const{parentContext:t,value:r,sddmNode:n,documentPart:o,scalars:s}=e;var i;if(null!==r)if(Array.isArray(r))r.forEach(((e,t)=>{ke({parentContext:{type:"list",object:r,index:t},value:e,sddmNode:n,documentPart:o,scalars:s})}));else if("object"==typeof r){if(!(i=n)||l(i)||!("f"in i))return;const e=r;for(const[t,r]of Object.entries(e)){const i=Ie(o,t),a=n.f[i?.name.value??t];a?.nt&&ke({parentContext:{type:"object",object:e,fieldName:t},value:r,sddmNode:a.nt,documentPart:i?.selectionSet??null,scalars:s})}}else{if(!t)return;if(ge(n)){const e=ye(n.codec.decode,r);"object"===t.type?t.object[t.fieldName]=e:t.object[t.index]=e}else if(Ne(n)){const e=ve(s,n),o=ye(e.codec.decode,r);"object"===t.type?t.object[t.fieldName]=o:t.object[t.index]=o}}},Ie=(e,t)=>{if(!e)return null;for(const r of e.selections){if(r.kind===ne.FIELD&&(r.alias?.value??r.name.value)===t)return r;if(r.kind===ne.INLINE_FRAGMENT){const e=Ie(r.selectionSet,t);if(null!==e)return e}}return null},Te=(e,t,r,n,o)=>{if(Ne(n)){const s=ve(o,n);e[t]=ye(s.codec.encode,r)}else{var s;if(ge(n))e[t]=ye(n.codec.encode,r);else if((s=n)&&!l(s)&&"f"in s)for(const e of n.fcs??[]){if("object"!=typeof r||null===r)continue;const t=r[e];if(void 0===t)continue;const s=n.f?.[e];s?.nt&&Te(r,e,t,s.nt,o)}}},xe=(e=>{const t=(e=>({passthroughErrorInstanceOf:e?.passthroughErrorInstanceOf??[],passthroughErrorWith:e?.passthroughErrorWith,entrypointSelectionMode:e?.entrypointSelectionMode??"required"}))(e);return d({steps:[],config:t,overloads:[]})})({passthroughErrorWith:e=>"exchange"===e.hookName&&(e=>e instanceof DOMException&&"AbortError"===e.name||e instanceof Error&&e.message.startsWith("AbortError:"))(e.error)}).input().step("encode",{run:e=>{const t=e.state.schemaMap,r=e.state.scalars.map;if(t){const n=de(e.request);e.request.query=n.query,(({sddm:e,request:t,scalars:r})=>{const n=t.operation.variableDefinitions;if(!n)return;const o=new Map(n.map((e=>[e.variable.name.value,e]))),s=t.variables??{};for(const t in s){const n=o.get(t);if(!n)continue;const i=s[t];if(void 0===i)continue;const a=ue(n.type),u=e.types[a.name.value];u&&Te(s,t,i,u,r)}})({sddm:t,scalars:r,request:n})}return e}}).step("pack").step("exchange").step("unpack").step("decode",{run:(e,t,r)=>(e.state.schemaMap&&!(!e.result.data&&(e.result.errors?.length??0)>0)&&(({request:e,data:t,sddm:r,scalars:n})=>{const o=r.operations[e.operation.operation];o&&t&&ke({parentContext:null,value:t,sddmNode:o,documentPart:e.operation.selectionSet,scalars:n})})({sddm:e.state.schemaMap,request:de(r.pack.input.request),data:e.result.data,scalars:e.state.scalars.map}),"http"===e.transportType?{...e.result,response:e.response}:e.result)}).type;var we;!function(e){(e.States||(e.States={})).empty={registry:{},configurations:{},current:null}}(we||(we={}));const Se="default";var be,Ce;!function(e){e.withTypeLevel=e=>e,(e.States||(e.States={})).empty={name:Se,requestPipelineDefinition:xe,transports:we.States.empty,checkPreflight:!0,input:{},output:r,schemaMap:null,extensions:[],scalars:he.empty}}(be||(be={})),function(e){e.createCallback=p}(Ce||(Ce={}));const Oe={requestResultDataTypes:()=>Oe,onRequestResult:()=>Oe,onRequestDocumentRootType:()=>Oe,type:null},De=e=>{const t=t=>{const r=e.normalizeConfig?.(t)??{},o=e.create({config:r,builder:Ce.createCallback,typeHooks:Oe}),s=o.builder,i=o.transport?.((e=>n({discriminant:["transportType",e]})))?.type;return{name:e.name,config:r,onRequest:o.onRequest,builder:s,transport:i?{name:i.discriminant[1],config:i.input,configInit:void 0,configDefaults:i.inputDefaults,requestPipelineOverload:i}:void 0,typeHooks:{requestResultDataTypes:null,onRequestDocumentRootType:[],onRequestResult:[]}}};return t.info={name:e.name},t},Ae=(e,t)=>({anyware:r=>e({...t,extensions:[...t.extensions,De({name:"InlineAnyware",create:()=>({onRequest:r})})()]})}),_e=e=>({document:(e=>{return Array.isArray(t=e[0])&&"raw"in t&&void 0!==t.raw;var t})(e)?(e=>{const[t,...r]=e;return t.reduce(((e,t,n)=>`${e}${t}${n in r?r[n]+"":""}`),"")})(e):e[0]}),Fe=(e,r)=>({gql:(...e)=>{const{document:n}=_e(e);return{send:async(...e)=>{if(!r.transports.current)throw Error("No transport selected");const{operationName:s,variables:i}=(e=>({operationName:l(e[0])?e[0]:void 0,variables:l(e[0])?e[1]:e[0]}))(e),a=(e=>{const{operationName:t,query:r}=e,n=r;if(!l(n)){const e=ce({query:n,operationName:t});if(e)return e.operation;throw Error("Could not parse operation type from document.")}const o=n.split(/[{}\n]+/).map((e=>e.trim())).map((e=>{const t=e.match(le);return t?{line:e,operationType:t[0]}:null})).filter((e=>null!==e));if(o.length>1&&!e.operationName)return null;if(0===o.length&&e.operationName)return null;if(0===o.length)return ie;const s=t?o.find((e=>e.line.includes(t))):o[0];return s?s.operationType:null})({query:n,variables:i,operationName:s});if(!a)throw Error("Could not get operation type");const u={transportType:r.transports.current,...r.transports.configurations[r.transports.current],state:r,request:{operation:a,query:n,variables:i,operationName:s}},c=o.create(r.requestPipelineDefinition),p=await(async(e,t)=>{const r=F(e);return await r(t)})(c,{initialInput:u,interceptors:r.extensions.filter((e=>void 0!==e.onRequest)).map((e=>e.onRequest))});return((e,r)=>{if((n=e.output).envelope.enabled&&n.envelope.errors.execution&&!n.envelope.errors.other){if(r instanceof Error)throw r;return r.value}var n;const o=e.output,s=o.envelope.enabled,i=!("throw"!==t(o,"other")||o.envelope.enabled&&o.envelope.errors.other),a=!("return"!==t(o,"other")||o.envelope.enabled&&o.envelope.errors.other),u=!("throw"!==t(o,"execution")||o.envelope.enabled&&o.envelope.errors.execution),c=!("return"!==t(o,"execution")||o.envelope.enabled&&o.envelope.errors.execution);if(r instanceof Error){if(i)throw r;return a?r:s?{errors:[r]}:r}if(r.value.errors&&r.value.errors.length>0){const e=new h("One or more errors in the execution result.",{},r.value.errors.map((e=>{if(e instanceof Error)return e;const{message:t,...r}=e;return new f(t,r)})));if(u)throw e;return c?e:s?{...r.value,errors:[...r.value.errors??[],e]}:e}return s?r.value:r.value.data})(r,p)}}}}),qe=(e,t)=>({scalar:(...r)=>{const n=Ee(r[0])?r[0]:me(r[0],r[1]);return e({...t,scalars:{...t.scalars,map:{...t.scalars.map,[n.name]:n}}})}}),Re=(e,t)=>({transport:(...r)=>{const n="string"==typeof r[0]?r[0]:t.transports.current,o=("string"==typeof r[0]?r[1]:r[0])??{};if(!n)throw Error("No transport is currently set.");const s=Pe(t,n,o);return e(s)}}),Pe=(e,t,r)=>{const n={...e.transports.configurations[t]??{},...r};return"http"===t&&r.headers&&(n.headers={...e.transports.configurations[t]?.headers,...r.headers}),{...e,transports:{...e.transports,current:t,configurations:{...e.transports.configurations,[t]:n}}}},Ve=(e,t)=>({use:r=>e(((e,t)=>{const r={...e,extensions:[...e.extensions,t]};if(t.transport){if(r.requestPipelineDefinition={...e.requestPipelineDefinition,overloads:[...e.requestPipelineDefinition.overloads,t.transport.requestPipelineOverload]},r.transports={current:e.transports.current,registry:{...e.transports.registry},configurations:{...e.transports.configurations}},void 0!==r.transports.registry[t.transport.name])throw Error(`Transport "${t.transport.name}" is already registered.`);null===r.transports.current&&(r.transports.current=t.transport.name),r.transports.registry[t.transport.name]=t.transport,r.transports.configurations[t.transport.name]={...t.transport.configDefaults,...t.transport.config}}return r})(t,r))}),je=t=>{const r={_:t,...(n=je,o=t,{with:t=>n(e(o,t))}),...Re(je,t),...Fe(0,t),...Ve(je,t),...Ae(je,t),...qe(je,t)};var n,o;return t.extensions.forEach((e=>{Object.assign(r,e.builder?.({client:r,context:t})??{})})),r},Me=(()=>{const t=e(be.States.empty,{});return je(t)})();console.log(Me);
