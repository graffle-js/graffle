const e=(e,t)=>{const r="object"==typeof t.output?.envelope?{enabled:!0,...t.output.envelope}:"boolean"==typeof t.output?.envelope?{enabled:t.output.envelope}:void 0,n={name:t.name??e?.name??Ue,schemaMap:t.schemaMap??e.schemaMap,output:{defaults:{errorChannel:t.output?.defaults?.errorChannel??e.output.defaults.errorChannel},envelope:{enabled:r?.enabled??e.output.envelope.enabled,errors:{execution:r?.errors?.execution??e.output.envelope.errors.execution,other:r?.errors?.other??e.output.envelope.errors.other,schema:r?.errors?.schema??e.output.envelope.errors.schema}},errors:{execution:t.output?.errors?.execution??e.output.errors.execution,other:t.output?.errors?.other??e.output.errors.other,schema:t.output?.errors?.schema??e.output.errors.schema}}};return $e.withTypeLevel({...e,...n})},t=(e,t)=>"default"===e.errors[t]?e.defaults.errorChannel:e.errors[t],r={defaults:{errorChannel:"throw"},envelope:{enabled:!1,errors:{execution:!0,other:!1}},errors:{execution:"default",other:"default"}},n=e=>{const t={discriminant:e.discriminant,inputDefaults:e.inputDefaults,steps:{}},r={type:t,config:()=>r,defaults:e=>(t.inputDefaults=e,r),configInit:()=>r,stepWithExtendedInput:()=>r.step,step:(e,n)=>(t.steps[e]={name:e,...n},r)};return r};var o;!function(e){e.create=e=>{let t=e.steps;e.overloads.length>0&&(t=t.map((t=>{const r=e.overloads.map((e=>{const r=e.steps[t.name];return r?{...r,discriminant:e.discriminant}:null})).filter((e=>null!==e));return{name:t.name,run:(...e)=>{const n=e[0],o=r.find((e=>n[e.discriminant[0]]===e.discriminant[1]));return o?o.run(...e):t.run(...e)},slots:{...t.slots,...r.reduce(((e,t)=>({...e,...t.slots})),{})}}})));const r=(e=>new Map(e.map((e=>[e.name,e]))))(t);return{...e,steps:t,stepsIndex:r}}}(o||(o={}));const a=e=>e instanceof Error?e:Error(e+""),i=e=>{throw Error("Unhandled case: "+e)},s=e=>"object"==typeof e&&null!==e&&!Array.isArray(e),u=e=>{let t,r,n=!1;return{promise:new Promise(((e,n)=>{t=e,r=n})),isResolved:()=>n,resolve:r=>{if(n=!0,e?.strict&&n)throw Error("Deferred is already resolved. Attempted to resolve with: "+JSON.stringify(r));t(r)},reject:e=>r(e)}},c=(...e)=>{globalThis.process?.env?.DEBUG&&console.log(...e)},l=(...e)=>(...t)=>{c(...e,...t)};new Proxy({},{get:()=>e=>e});const p=e=>"string"==typeof e,d=e=>e,m=e=>{const t={type:e,input:()=>t,done:()=>o.create(e),stepWithRunnerType:()=>t.step,step:(...t)=>{const r="string"==typeof t[0]?{name:t[0],run:f,...t[1]}:{run:f,...t[0]};return m({...e,steps:[...e.steps,r]})},use:t=>m({...e,overloads:[...e.overloads,...t.type.overloads]}),overload:t=>{const r=t({create:n});return e.overloads.push(r.type),m(e)}};return t},f=e=>e.input;class h extends Error{context;cause;name="ContextualError";constructor(e,t={},r=void 0){super(e,r),this.context=t,this.cause=r}}class v extends h{errors;name="ContextualAggregateError";constructor(e,t,r){super(e,t,void 0),this.errors=r}}const y=/^(?:(?<async>async)\s+)?(?:function\s+)?(?:(?<name>[A-z_0-9]+)\s*)?\((?<parameters>[^)]*)\)\s*(?:=>\s*(?<bodyExpression>[^\s{].*)|(?:=>\s*)?{(?<bodyStatement>.*)})$/s,g=/(?<destructured>\{[^}]+\})|(?<name>[A-z_][A-z_0-9]*)/gs,E=/(?<name>[A-z_][A-z_0-9]*)(?::[^},]+)?/gs;class N extends h{constructor(e){super("Interceptor must destructure the first parameter passed to it and select exactly one step.",e)}}const I="multipleParameters",k="noParameters",b="notDestructured",S="destructuredWithoutEntryHook",w="multipleDestructuredHookNames",x="invalidDestructuredHookNames",T=Symbol("resultEnvelope"),D=e=>({[T]:T,result:e});var O;!function(e){e.create=(e,t)=>(t.input=e,t)}(O||(O={}));const C=e=>({...e,currentChunk:u()}),A=async({pipeline:e,name:t,done:r,inputOriginalOrFromExtension:n,previousStepsCompleted:o,interceptorsStack:s,nextInterceptorsStack:c,asyncErrorDeferred:p,customSlots:d})=>{const m=l(`step ${t}:`);m("advance to next interceptor");const[f,...v]=s;if(!(0===v.length)&&f?.retrying&&r({type:"error",source:"user",extensionName:f.name,hookName:t,error:new h("Only the last extension can retry hooks.",{extensionsAfter:v.map((e=>({name:e.name})))})}),f){const s=l(`hook ${t}: extension ${f.name}:`),y=u();s("start");let g=!1;const E=O.create(n,(a=>{s("extension calls this hook",a);const i=a?.input??n,l={...d,...a?.using};if(y.isResolved()){if(f.retrying){if(g){s("execute branch: retry");const i=C(f);return A({pipeline:e,name:t,done:r,previousStepsCompleted:o,inputOriginalOrFromExtension:n,asyncErrorDeferred:p,interceptorsStack:[i],nextInterceptorsStack:c,customSlots:l}),i.currentChunk.promise.then((async e=>{const r=e[t];if(!r)throw Error("Hook not found in envelope: "+t);return await r({...a,input:a?.input??n})}))}return p.resolve({type:"error",source:"extension",interceptorName:f.name,hookName:t,error:new h("Only after failure can a hook be called again by a retrying extension.",{hookName:t,extensionName:f.name})}),u().promise}return p.resolve({type:"error",source:"extension",interceptorName:f.name,hookName:t,error:new h("Only a retrying extension can retry hooks.",{hookName:t,extensionsAfter:v.map((e=>({name:e.name})))})}),u().promise}{const n=C(f),a=[...c,n];return y.resolve(!0),A({pipeline:e,name:t,done:r,previousStepsCompleted:o,asyncErrorDeferred:p,inputOriginalOrFromExtension:i,interceptorsStack:v,nextInterceptorsStack:a,customSlots:l}),n.currentChunk.promise.then((e=>(e instanceof Error&&(s("received hook error"),g=!0),e)))}}));s("advance with envelope");const N={[t]:E};f.currentChunk.resolve(N),m("start race between extension returning or invoking next hook");const{branch:I,result:k}=await Promise.race([y.promise.then((e=>({branch:"hookInvoked",result:e}))).catch((e=>({branch:"hookInvokedButThrew",result:e}))),f.body.promise.then((e=>({branch:"extensionReturned",result:e}))).catch((e=>({branch:"extensionThrew",result:e})))]);switch(I){case"hookInvoked":return void s("invoked next hook (or retrying extension got error pushed through)");case"extensionReturned":return s("extension returned"),void(k===N?A({pipeline:e,name:t,done:r,previousStepsCompleted:o,inputOriginalOrFromExtension:n,asyncErrorDeferred:p,interceptorsStack:v,nextInterceptorsStack:c,customSlots:d}):r({type:"shortCircuited",result:k}));case"extensionThrew":return s("extension threw"),void r({type:"error",hookName:t,source:"extension",error:a(k),interceptorName:f.name});case"hookInvokedButThrew":return s("hook error"),void r({type:"error",hookName:t,source:"implementation",error:a(k)});default:throw i(I)}}else{m("no more interceptors to advance, run implementation");const i=e.stepsIndex.get(t);if(!i)throw new h("Implementation not found for step name "+t,{hookName:t});let s;try{const e={...i.slots,...d};s=await i.run(n,e,o)}catch(e){m("implementation error");const n=c[c.length-1];return void(n&&n.retrying?n.currentChunk.resolve(a(e)):r({type:"error",hookName:t,source:"implementation",error:a(e)}))}m("completed"),r({type:"completed",result:s,effectiveInput:n,nextExtensionsStack:c})}},q=async({pipeline:e,stepsToProcess:t,originalInputOrResult:r,interceptorsStack:n,asyncErrorDeferred:o,previousStepsCompleted:a})=>{const[s,...l]=t;if(!s){c("pipeline: ending");const e=await F({interceptorsStack:n,result:r});return c("pipeline: returning"),D(e)}c(`hook ${s.name}: start`);const p=u({strict:!1});A({pipeline:e,name:s.name,done:p.resolve,inputOriginalOrFromExtension:r,previousStepsCompleted:a,interceptorsStack:n,asyncErrorDeferred:o,customSlots:{},nextInterceptorsStack:[]});const d=await Promise.race([p.promise,o.promise]);switch(d.type){case"completed":{const{result:t,effectiveInput:r,nextExtensionsStack:n}=d,i={...a,[s.name]:{input:r}};return await q({pipeline:e,stepsToProcess:l,originalInputOrResult:t,interceptorsStack:n,previousStepsCompleted:i,asyncErrorDeferred:o})}case"shortCircuited":{c("signal: shortCircuited");const{result:e}=d;return D(e)}case"error":{if(c("signal: error"),e.config.passthroughErrorWith?.(d))return d.error;if(e.config.passthroughErrorInstanceOf.some((e=>d.error instanceof e)))return d.error;const t=o.isResolved();switch(d.source){case"extension":{const e="anonymous"===d.interceptorName?" (use named functions to improve this error message)":"";return new h(t?`There was an error in the interceptor "${d.interceptorName}"${e}.`:`There was an error in the interceptor "${d.interceptorName}"${e} while running hook "${d.hookName}".`,{hookName:d.hookName,source:d.source,interceptorName:d.interceptorName},d.error)}case"implementation":return new h(`There was an error in the core implementation of hook "${d.hookName}".`,{hookName:d.hookName,source:d.source},d.error);case"user":return d.error;default:throw i(d)}}default:throw i(d)}},F=async({interceptorsStack:e,result:t})=>{const[r,...n]=e;if(!r)return t;c(`interceptor ${r.name}: end`),r.currentChunk.resolve(t);const o=await r.body.promise;return await F({interceptorsStack:n,result:o})},_=e=>async t=>{const{initialInput:r,interceptors:n=[],retryingInterceptor:o}=t??{};var a;const i=(o?[...n,(a=o,{retrying:!0,run:a})]:n).map((t=>V(e,t))),[s,c]=(e=>{const[t,r]=(e=>{const t=[],r=[];for(const n of e)n instanceof Error?t.push(n):r.push(n);return[r,t]})(e);return[t,r.length>0?new v("One or more extensions are invalid.",{},r):null]})(i);if(c)return c;const l=u({strict:!1}),p=await q({pipeline:e,stepsToProcess:e.steps,originalInputOrResult:r,interceptorsStack:s,asyncErrorDeferred:l,previousStepsCompleted:{}});return p instanceof Error?p:(e=>({value:e}))(p.result)},V=(e,t)=>{const r=u(),n=u(),o="function"==typeof t?t:t.run,a="function"!=typeof t&&t.retrying,s=async e=>{try{const t=await o(e);n.resolve(t)}catch(e){n.reject(e)}},c=o.name||"anonymous";switch(e.config.entrypointSelectionMode){case"off":return r.promise.then(s),{name:c,entrypoint:e.steps[0]?.name,body:n,currentChunk:r};case"optional":case"required":{const t=((e,t)=>{const r=e.stepsIndex,n=(e=>{const t=(""+e).match(y)?.groups;if(!t)throw Error("Could not extract groups from function.");const r=t.bodyStatement??t.bodyExpression;if(void 0===r)throw Error("Could not extract body from function.");const n=[];if(t.parameters){const e=[...t.parameters.matchAll(g)].map((e=>{const t=e.groups?.destructured?"destructured":e.groups?.name?"name":null;switch(t){case"destructured":return{type:t,names:[...e.groups.destructured.matchAll(E)].map((e=>{const t=e.groups.name;if(void 0===t)throw Error("Could not extract name from destructured parameter.");return t}))};case"name":return{type:t,value:e.groups.name};case null:throw Error("Could not determine type of parameter.");default:throw i(t)}}));n.push(...e)}return{body:r,parameters:n}})(t);if(n.parameters.length>1)return new N({issue:I});const o=n.parameters[0];if(o){if("name"===o.type)return new N({issue:b});{if(0===o.names.length)return new N({issue:S});const e=o.names.filter((e=>r.has(e)));if(e.length>1)return new N({issue:w});const t=e[0];return t?r.get(t)||new N({issue:S}):new N({issue:x})}}return new N({issue:k})})(e,o);if(t instanceof Error)return"required"===e.config.entrypointSelectionMode?t:(r.promise.then(s),{name:c,entrypoint:e.steps[0]?.name,body:n,currentChunk:r});const u=[];for(const r of e.steps){if(r===t)break;u.push(r.name)}const l=u.map((e=>R(e)));let p=r.promise;for(const e of l)p=p.then(e);return p.then(s),{retrying:a,name:c,entryStep:t,body:n,currentChunk:r}}default:throw i(e.config.entrypointSelectionMode)}},R=e=>async t=>{const r=t[e];if(!r)throw new h("Hook not found in hook envelope",{hookName:e});return await r({input:r.input})};class P extends Error{constructor(e,t,r,n,o,a,i){super(e),this.name="GraphQLError",this.message=e,o&&(this.path=o),t&&(this.nodes=Array.isArray(t)?t:[t]),r&&(this.source=r),n&&(this.positions=n),a&&(this.originalError=a);var s=i;if(!s&&a){var u=a.extensions;u&&"object"==typeof u&&(s=u)}this.extensions=s||{}}toJSON(){return{...this,message:this.message}}toString(){return this.message}get[Symbol.toStringTag](){return"GraphQLError"}}var j,L;function M(e){return new P(`Syntax Error: Unexpected token at ${L} in ${e}`)}function U(e){if(e.lastIndex=L,e.test(j))return j.slice(L,L=e.lastIndex)}var $=/ +(?=[^\s])/y;function B(e){for(var t=e.split("\n"),r="",n=0,o=0,a=t.length-1,i=0;t.length>i;i++)$.lastIndex=0,$.test(t[i])&&(!i||n&&$.lastIndex>=n||(n=$.lastIndex),o=o||i,a=i);for(var s=o;a>=s;s++)s!==o&&(r+="\n"),r+=t[s].slice(n).replace(/\\"""/g,'"""');return r}function Y(){for(var e=0|j.charCodeAt(L++);9===e||10===e||13===e||32===e||35===e||44===e||65279===e;e=0|j.charCodeAt(L++))if(35===e)for(;10!==(e=j.charCodeAt(L++))&&13!==e;);L--}var H,J=/[_A-Za-z]\w*/y,z=RegExp("(?:(null|true|false)|\\$("+J.source+')|(-?\\d+)((?:\\.\\d+)?[eE][+-]?\\d+|\\.\\d+)?|("""(?:"""|(?:[\\s\\S]*?[^\\\\])"""))|("(?:"|[^\\r\\n]*?[^\\\\]"))|('+J.source+"))","y"),G=((H=G||{})[H.Const=1]="Const",H[H.Var=2]="Var",H[H.Int=3]="Int",H[H.Float=4]="Float",H[H.BlockString=5]="BlockString",H[H.String=6]="String",H[H.Enum=7]="Enum",H),W=/\\/;function X(e){var t,r;if(z.lastIndex=L,91===j.charCodeAt(L)){L++,Y();for(var n=[];93!==j.charCodeAt(L);)n.push(X(e));return L++,Y(),{kind:"ListValue",values:n}}if(123===j.charCodeAt(L)){L++,Y();for(var o=[];125!==j.charCodeAt(L);){if(null==(t=U(J)))throw M("ObjectField");if(Y(),58!==j.charCodeAt(L++))throw M("ObjectField");Y(),o.push({kind:"ObjectField",name:{kind:"Name",value:t},value:X(e)})}return L++,Y(),{kind:"ObjectValue",fields:o}}if(null!=(r=z.exec(j))){if(L=z.lastIndex,Y(),null!=(t=r[G.Const]))return"null"===t?{kind:"NullValue"}:{kind:"BooleanValue",value:"true"===t};if(null!=(t=r[G.Var])){if(e)throw M("Variable");return{kind:"Variable",name:{kind:"Name",value:t}}}var a;if(null!=(t=r[G.Int]))return null!=(a=r[G.Float])?{kind:"FloatValue",value:t+a}:{kind:"IntValue",value:t};if(null!=(t=r[G.BlockString]))return{kind:"StringValue",value:B(t.slice(3,-3)),block:!0};if(null!=(t=r[G.String]))return{kind:"StringValue",value:W.test(t)?JSON.parse(t):t.slice(1,-1),block:!1};if(null!=(t=r[G.Enum]))return{kind:"EnumValue",value:t}}throw M("Value")}function Q(e){if(40===j.charCodeAt(L)){var t,r=[];L++,Y();do{if(null==(t=U(J)))throw M("Argument");if(Y(),58!==j.charCodeAt(L++))throw M("Argument");Y(),r.push({kind:"Argument",name:{kind:"Name",value:t},value:X(e)})}while(41!==j.charCodeAt(L));return L++,Y(),r}}function Z(e){if(64===j.charCodeAt(L)){var t,r=[];do{if(L++,null==(t=U(J)))throw M("Directive");Y(),r.push({kind:"Directive",name:{kind:"Name",value:t},arguments:Q(e)})}while(64===j.charCodeAt(L));return r}}function K(){for(var e,t=0;91===j.charCodeAt(L);)t++,L++,Y();if(null==(e=U(J)))throw M("NamedType");Y();var r={kind:"NamedType",name:{kind:"Name",value:e}};do{if(33===j.charCodeAt(L)&&(L++,Y(),r={kind:"NonNullType",type:r}),t){if(93!==j.charCodeAt(L++))throw M("NamedType");Y(),r={kind:"ListType",type:r}}}while(t--);return r}var ee=RegExp("(?:(\\.{3})|("+J.source+"))","y"),te=function(e){return e[e.Spread=1]="Spread",e[e.Name=2]="Name",e}(te||{});function re(){var e,t,r=[];do{if(ee.lastIndex=L,null==(t=ee.exec(j)))throw M("SelectionSet");if(L=ee.lastIndex,null!=t[te.Spread]){Y();var n=U(J);if(null!=n&&"on"!==n)Y(),r.push({kind:"FragmentSpread",name:{kind:"Name",value:n},directives:Z(!1)});else{if(Y(),"on"===n){if(null==(n=U(J)))throw M("NamedType");Y()}var o=Z(!1);if(123!==j.charCodeAt(L++))throw M("InlineFragment");Y(),r.push({kind:"InlineFragment",typeCondition:n?{kind:"NamedType",name:{kind:"Name",value:n}}:void 0,directives:o,selectionSet:re()})}}else if(null!=(e=t[te.Name])){var a=void 0;if(Y(),58===j.charCodeAt(L)){if(L++,Y(),a=e,null==(e=U(J)))throw M("Field");Y()}var i=Q(!1);Y();var s=Z(!1),u=void 0;123===j.charCodeAt(L)&&(L++,Y(),u=re()),r.push({kind:"Field",alias:a?{kind:"Name",value:a}:void 0,name:{kind:"Name",value:e},arguments:i,directives:s,selectionSet:u})}}while(125!==j.charCodeAt(L));return L++,Y(),{kind:"SelectionSet",selections:r}}function ne(){var e,t;if(null==(e=U(J)))throw M("FragmentDefinition");if(Y(),"on"!==U(J))throw M("FragmentDefinition");if(Y(),null==(t=U(J)))throw M("FragmentDefinition");Y();var r=Z(!1);if(123!==j.charCodeAt(L++))throw M("FragmentDefinition");return Y(),{kind:"FragmentDefinition",name:{kind:"Name",value:e},typeCondition:{kind:"NamedType",name:{kind:"Name",value:t}},directives:r,selectionSet:re()}}var oe=/(?:query|mutation|subscription|fragment)/y;function ae(e){var t,r,n;if(e&&(Y(),t=U(J),r=function(){if(Y(),40===j.charCodeAt(L)){var e,t=[];L++,Y();do{if(36!==j.charCodeAt(L++))throw M("Variable");if(null==(e=U(J)))throw M("Variable");if(Y(),58!==j.charCodeAt(L++))throw M("VariableDefinition");Y();var r=K(),n=void 0;61===j.charCodeAt(L)&&(L++,Y(),n=X(!0)),Y(),t.push({kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:e}},type:r,defaultValue:n,directives:Z(!0)})}while(41!==j.charCodeAt(L));return L++,Y(),t}}(),n=Z(!1)),123===j.charCodeAt(L))return L++,Y(),{kind:"OperationDefinition",operation:e||"query",name:t?{kind:"Name",value:t}:void 0,variableDefinitions:r,directives:n,selectionSet:re()}}function ie(e,t,r){for(var n="",o=0;e.length>o;o++)o&&(n+=t),n+=r(e[o]);return n}var se,ue="\n",ce={OperationDefinition(e){var t=e.operation;return e.name&&(t+=" "+e.name.value),e.variableDefinitions&&e.variableDefinitions.length&&(e.name||(t+=" "),t+="("+ie(e.variableDefinitions,", ",ce.VariableDefinition)+")"),e.directives&&e.directives.length&&(t+=" "+ie(e.directives," ",ce.Directive)),"query"!==t?t+" "+ce.SelectionSet(e.selectionSet):ce.SelectionSet(e.selectionSet)},VariableDefinition(e){var t=ce.Variable(e.variable)+": "+le(e.type);return e.defaultValue&&(t+=" = "+le(e.defaultValue)),e.directives&&e.directives.length&&(t+=" "+ie(e.directives," ",ce.Directive)),t},Field(e){var t=e.alias?e.alias.value+": "+e.name.value:e.name.value;if(e.arguments&&e.arguments.length){var r=ie(e.arguments,", ",ce.Argument);t+=t.length+r.length+2>80?"("+(ue+="  ")+ie(e.arguments,ue,ce.Argument)+(ue=ue.slice(0,-2))+")":"("+r+")"}return e.directives&&e.directives.length&&(t+=" "+ie(e.directives," ",ce.Directive)),e.selectionSet&&e.selectionSet.selections.length&&(t+=" "+ce.SelectionSet(e.selectionSet)),t},StringValue:e=>e.block?function(e){return'"""\n'+e.replace(/"""/g,'\\"""')+'\n"""'}(e.value).replace(/\n/g,ue):function(e){return JSON.stringify(e)}(e.value),BooleanValue:e=>""+e.value,NullValue:e=>"null",IntValue:e=>e.value,FloatValue:e=>e.value,EnumValue:e=>e.value,Name:e=>e.value,Variable:e=>"$"+e.name.value,ListValue:e=>"["+ie(e.values,", ",le)+"]",ObjectValue:e=>"{"+ie(e.fields,", ",ce.ObjectField)+"}",ObjectField:e=>e.name.value+": "+le(e.value),Document:e=>e.definitions&&e.definitions.length?ie(e.definitions,"\n\n",le):"",SelectionSet:e=>"{"+(ue+="  ")+ie(e.selections,ue,le)+(ue=ue.slice(0,-2))+"}",Argument:e=>e.name.value+": "+le(e.value),FragmentSpread(e){var t="..."+e.name.value;return e.directives&&e.directives.length&&(t+=" "+ie(e.directives," ",ce.Directive)),t},InlineFragment(e){var t="...";return e.typeCondition&&(t+=" on "+e.typeCondition.name.value),e.directives&&e.directives.length&&(t+=" "+ie(e.directives," ",ce.Directive)),t+" "+ce.SelectionSet(e.selectionSet)},FragmentDefinition(e){var t="fragment "+e.name.value;return t+=" on "+e.typeCondition.name.value,e.directives&&e.directives.length&&(t+=" "+ie(e.directives," ",ce.Directive)),t+" "+ce.SelectionSet(e.selectionSet)},Directive(e){var t="@"+e.name.value;return e.arguments&&e.arguments.length&&(t+="("+ie(e.arguments,", ",ce.Argument)+")"),t},NamedType:e=>e.name.value,ListType:e=>"["+le(e.type)+"]",NonNullType:e=>le(e.type)+"!"},le=e=>ce[e.kind](e);!function(e){e.NAME="Name",e.DOCUMENT="Document",e.OPERATION_DEFINITION="OperationDefinition",e.VARIABLE_DEFINITION="VariableDefinition",e.SELECTION_SET="SelectionSet",e.FIELD="Field",e.ARGUMENT="Argument",e.FRAGMENT_SPREAD="FragmentSpread",e.INLINE_FRAGMENT="InlineFragment",e.FRAGMENT_DEFINITION="FragmentDefinition",e.VARIABLE="Variable",e.INT="IntValue",e.FLOAT="FloatValue",e.STRING="StringValue",e.BOOLEAN="BooleanValue",e.NULL="NullValue",e.ENUM="EnumValue",e.LIST="ListValue",e.OBJECT="ObjectValue",e.OBJECT_FIELD="ObjectField",e.DIRECTIVE="Directive",e.NAMED_TYPE="NamedType",e.LIST_TYPE="ListType",e.NON_NULL_TYPE="NonNullType",e.SCHEMA_DEFINITION="SchemaDefinition",e.OPERATION_TYPE_DEFINITION="OperationTypeDefinition",e.SCALAR_TYPE_DEFINITION="ScalarTypeDefinition",e.OBJECT_TYPE_DEFINITION="ObjectTypeDefinition",e.FIELD_DEFINITION="FieldDefinition",e.INPUT_VALUE_DEFINITION="InputValueDefinition",e.INTERFACE_TYPE_DEFINITION="InterfaceTypeDefinition",e.UNION_TYPE_DEFINITION="UnionTypeDefinition",e.ENUM_TYPE_DEFINITION="EnumTypeDefinition",e.ENUM_VALUE_DEFINITION="EnumValueDefinition",e.INPUT_OBJECT_TYPE_DEFINITION="InputObjectTypeDefinition",e.DIRECTIVE_DEFINITION="DirectiveDefinition",e.SCHEMA_EXTENSION="SchemaExtension",e.SCALAR_TYPE_EXTENSION="ScalarTypeExtension",e.OBJECT_TYPE_EXTENSION="ObjectTypeExtension",e.INTERFACE_TYPE_EXTENSION="InterfaceTypeExtension",e.UNION_TYPE_EXTENSION="UnionTypeExtension",e.ENUM_TYPE_EXTENSION="EnumTypeExtension",e.INPUT_OBJECT_TYPE_EXTENSION="InputObjectTypeExtension"}(se||(se={}));const pe="query",de=e=>"object"==typeof e&&null!==e&&"kind"in e&&"OperationDefinition"===e.kind,me={query:"read",mutation:"write",subscription:"read"},fe=e=>{const t=e;return p(t)?t:function(e){return ue="\n",ce[e.kind]?ce[e.kind](e):""}(t)},he=e=>"NamedType"===e.kind?e:he(e.type),ve=e=>{for(const t of e.query.definitions){const r=de(t)?t:null;if(!e.operationName)return r;if(r?.name?.value===e.operationName)return r}return null},ye=RegExp(`^\\b(${Object.values(Object.freeze({__proto__:null,MUTATION:"mutation",QUERY:pe,SUBSCRIPTION:"subscription"})).join("|")})\\b`),ge=e=>{const t=e;return p(t)?function(e){return L=0,function(e){var t,r;Y();var n,o=[];do{if("fragment"===(t=U(oe)))Y(),o.push(ne());else{if(null==(r=ae(t)))throw M("Document");o.push(r)}}while(e.length>L);return{kind:"Document",definitions:o,set loc(e){n=e},get loc(){return n||(n={start:0,end:e.length,startToken:void 0,endToken:void 0,source:{body:e,name:"graphql.web",locationOffset:{line:1,column:1}}}),n}}}(j="string"==typeof e.body?e.body:e)}(t):t},Ee=e=>{const t=ge(e.query);if("operation"in e){const r=ve({...e,query:ge(e.query)});return{...e,operation:r,query:t}}return{...e,query:t}},Ne=(e,t)=>({kind:"Scalar",name:e,codec:t}),Ie=Ne("String",{encode:e=>e,decode:e=>e});var ke;!function(e){e.empty={map:{}}}(ke||(ke={}));const be=(e,t)=>e[t]||Ie,Se=(e,t)=>null===t?null:Array.isArray(t)?t.map((t=>Se(e,t))):e(t),we=e=>"object"==typeof e&&null!==e&&"codec"in e&&"object"==typeof e.codec,xe=e=>p(e),Te=we,De=e=>{const{parentContext:t,value:r,sddmNode:n,documentPart:o,scalars:a}=e;var i;if(null!==r)if(Array.isArray(r))r.forEach(((e,t)=>{De({parentContext:{type:"list",object:r,index:t},value:e,sddmNode:n,documentPart:o,scalars:a})}));else if("object"==typeof r){if(!(i=n)||p(i)||!("f"in i))return;const e=r;for(const[t,r]of Object.entries(e)){const i=Oe(o,t),s=n.f[i?.name.value??t];s?.nt&&De({parentContext:{type:"object",object:e,fieldName:t},value:r,sddmNode:s.nt,documentPart:i?.selectionSet??null,scalars:a})}}else{if(!t)return;if(Te(n)){const e=Se(n.codec.decode,r);"object"===t.type?t.object[t.fieldName]=e:t.object[t.index]=e}else if(xe(n)){const e=be(a,n),o=Se(e.codec.decode,r);"object"===t.type?t.object[t.fieldName]=o:t.object[t.index]=o}}},Oe=(e,t)=>{if(!e)return null;for(const r of e.selections){if(r.kind===se.FIELD&&(r.alias?.value??r.name.value)===t)return r;if(r.kind===se.INLINE_FRAGMENT){const e=Oe(r.selectionSet,t);if(null!==e)return e}}return null},Ce="application/json",Ae=(e,t)=>{const r=((e,t)=>{const r=new Headers(e),n=new Headers(t);for(const[e,t]of n.entries())""===t?r.delete(e):r.set(e,t);return r})(e?.headers??{},t?.headers??{});return{...e,...t,headers:r}},qe=(e,t)=>{const r=new URL(e);return((e,t)=>{new URLSearchParams(t).forEach(((t,r)=>{e.searchParams.append(r,t)}))})(r,t),r},Fe=`application/graphql-response+json; charset=utf-8, ${Ce}; charset=utf-8`,_e={accept:Fe,"content-type":Ce},Ve={accept:Fe},Re=e=>({query:e.query,...e.variables?{variables:JSON.stringify(e.variables)}:{},...e.operationName?{operationName:e.operationName}:{}}),Pe=e=>JSON.stringify({query:e.query,variables:e.variables,operationName:e.operationName}),je=(e,t,r,n,o)=>{if(xe(n)){const a=be(o,n);e[t]=Se(a.codec.encode,r)}else{var a;if(Te(n))e[t]=Se(n.codec.encode,r);else if((a=n)&&!p(a)&&"f"in a)for(const e of n.fcs??[]){if("object"!=typeof r||null===r)continue;const t=r[e];if(void 0===t)continue;const a=n.f?.[e];a?.nt&&je(r,e,t,a.nt,o)}}},Le=(e=>{const t=(e=>({passthroughErrorInstanceOf:e?.passthroughErrorInstanceOf??[],passthroughErrorWith:e?.passthroughErrorWith,entrypointSelectionMode:e?.entrypointSelectionMode??"required"}))(e);return m({steps:[],config:t,overloads:[]})})({passthroughErrorWith:e=>"exchange"===e.hookName&&(e=>e instanceof DOMException&&"AbortError"===e.name||e instanceof Error&&e.message.startsWith("AbortError:"))(e.error)}).input().step("encode",{run:e=>{const t=e.state.schemaMap,r=e.state.scalars.map;if(t){const n=Ee(e.request);e.request.query=n.query,(({sddm:e,request:t,scalars:r})=>{const n=t.operation.variableDefinitions;if(!n)return;const o=new Map(n.map((e=>[e.variable.name.value,e]))),a=t.variables??{};for(const t in a){const n=o.get(t);if(!n)continue;const i=a[t];if(void 0===i)continue;const s=he(n.type),u=e.types[s.name.value];u&&je(a,t,i,u,r)}})({sddm:t,scalars:r,request:n})}return e}}).step("pack").step("exchange").step("unpack").step("decode",{run:(e,t,r)=>(e.state.schemaMap&&!(!e.result.data&&(e.result.errors?.length??0)>0)&&(({request:e,data:t,sddm:r,scalars:n})=>{const o=r.operations[e.operation.operation];o&&t&&De({parentContext:null,value:t,sddmNode:o,documentPart:e.operation.selectionSet,scalars:n})})({sddm:e.state.schemaMap,request:Ee(r.pack.input.request),data:e.result.data,scalars:e.state.scalars.map}),"http"===e.transportType?{...e.result,response:e.response}:e.result)}).type;var Me;!function(e){(e.States||(e.States={})).empty={registry:{},configurations:{},current:null}}(Me||(Me={}));const Ue="default";var $e,Be;!function(e){e.withTypeLevel=e=>e,(e.States||(e.States={})).empty={name:Ue,requestPipelineDefinition:Le,transports:Me.States.empty,checkPreflight:!0,input:{},output:r,schemaMap:null,extensions:[],scalars:ke.empty}}($e||($e={})),function(e){e.createCallback=d}(Be||(Be={}));const Ye={requestResultDataTypes:()=>Ye,onRequestResult:()=>Ye,onRequestDocumentRootType:()=>Ye,type:null},He=e=>{const t=t=>{const r=e.normalizeConfig?.(t)??{},o=e.create({config:r,builder:Be.createCallback,typeHooks:Ye}),a=o.builder,i=o.transport?.((e=>n({discriminant:["transportType",e]})))?.type;return{name:e.name,config:r,onRequest:o.onRequest,builder:a,transport:i?{name:i.discriminant[1],config:i.input,configInit:void 0,configDefaults:i.inputDefaults,requestPipelineOverload:i}:void 0,typeHooks:{requestResultDataTypes:null,onRequestDocumentRootType:[],onRequestResult:[]}}};return t.info={name:e.name},t},Je=(e,t)=>({anyware:r=>e({...t,extensions:[...t.extensions,He({name:"InlineAnyware",create:()=>({onRequest:r})})()]})}),ze=e=>({document:(e=>{return Array.isArray(t=e[0])&&"raw"in t&&void 0!==t.raw;var t})(e)?(e=>{const[t,...r]=e;return t.reduce(((e,t,n)=>`${e}${t}${n in r?r[n]+"":""}`),"")})(e):e[0]}),Ge=(e,r)=>({gql:(...e)=>{const{document:n}=ze(e);return{send:async(...e)=>{if(!r.transports.current)throw Error("No transport selected");const{operationName:a,variables:i}=(e=>({operationName:p(e[0])?e[0]:void 0,variables:p(e[0])?e[1]:e[0]}))(e),s=(e=>{const{operationName:t,query:r}=e,n=r;if(!p(n)){const e=ve({query:n,operationName:t});if(e)return e.operation;throw Error("Could not parse operation type from document.")}const o=n.split(/[{}\n]+/).map((e=>e.trim())).map((e=>{const t=e.match(ye);return t?{line:e,operationType:t[0]}:null})).filter((e=>null!==e));if(o.length>1&&!e.operationName)return null;if(0===o.length&&e.operationName)return null;if(0===o.length)return pe;const a=t?o.find((e=>e.line.includes(t))):o[0];return a?a.operationType:null})({query:n,variables:i,operationName:a});if(!s)throw Error("Could not get operation type");const u={transportType:r.transports.current,...r.transports.configurations[r.transports.current],state:r,request:{operation:s,query:n,variables:i,operationName:a}},c=o.create(r.requestPipelineDefinition),l=await(async(e,t)=>{const r=_(e);return await r(t)})(c,{initialInput:u,interceptors:r.extensions.filter((e=>void 0!==e.onRequest)).map((e=>e.onRequest))});return((e,r)=>{if((n=e.output).envelope.enabled&&n.envelope.errors.execution&&!n.envelope.errors.other){if(r instanceof Error)throw r;return r.value}var n;const o=e.output,a=o.envelope.enabled,i=!("throw"!==t(o,"other")||o.envelope.enabled&&o.envelope.errors.other),s=!("return"!==t(o,"other")||o.envelope.enabled&&o.envelope.errors.other),u=!("throw"!==t(o,"execution")||o.envelope.enabled&&o.envelope.errors.execution),c=!("return"!==t(o,"execution")||o.envelope.enabled&&o.envelope.errors.execution);if(r instanceof Error){if(i)throw r;return s?r:a?{errors:[r]}:r}if(r.value.errors&&r.value.errors.length>0){const e=new v("One or more errors in the execution result.",{},r.value.errors.map((e=>{if(e instanceof Error)return e;const{message:t,...r}=e;return new h(t,r)})));if(u)throw e;return c?e:a?{...r.value,errors:[...r.value.errors??[],e]}:e}return a?r.value:r.value.data})(r,l)}}}}),We=(e,t)=>({scalar:(...r)=>{const n=we(r[0])?r[0]:Ne(r[0],r[1]);return e({...t,scalars:{...t.scalars,map:{...t.scalars.map,[n.name]:n}}})}}),Xe=(e,t)=>({transport:(...r)=>{const n="string"==typeof r[0]?r[0]:t.transports.current,o=("string"==typeof r[0]?r[1]:r[0])??{};if(!n)throw Error("No transport is currently set.");const a=Qe(t,n,o);return e(a)}}),Qe=(e,t,r)=>{const n={...e.transports.configurations[t]??{},...r};return"http"===t&&r.headers&&(n.headers={...e.transports.configurations[t]?.headers,...r.headers}),{...e,transports:{...e.transports,current:t,configurations:{...e.transports.configurations,[t]:n}}}},Ze=(e,t)=>{const r={...e,extensions:[...e.extensions,t]};if(t.transport){if(r.requestPipelineDefinition={...e.requestPipelineDefinition,overloads:[...e.requestPipelineDefinition.overloads,t.transport.requestPipelineOverload]},r.transports={current:e.transports.current,registry:{...e.transports.registry},configurations:{...e.transports.configurations}},void 0!==r.transports.registry[t.transport.name])throw Error(`Transport "${t.transport.name}" is already registered.`);null===r.transports.current&&(r.transports.current=t.transport.name),r.transports.registry[t.transport.name]=t.transport,r.transports.configurations[t.transport.name]={...t.transport.configDefaults,...t.transport.config}}return r},Ke=(e,t)=>({use:r=>e(Ze(t,r))}),et=t=>{const r={_:t,...(n=et,o=t,{with:t=>n(e(o,t))}),...Xe(et,t),...Ge(0,t),...Ke(et,t),...Je(et,t),...We(et,t)};var n,o;return t.extensions.forEach((e=>{Object.assign(r,e.builder?.({client:r,context:t})??{})})),r},tt={methodMode:"post"},rt=He({name:"TransportHttp",normalizeConfig:e=>({...tt,...e,url:e?.url?new URL(e.url):void 0}),create:({config:e})=>({transport:t=>t("http").config().defaults(e).stepWithExtendedInput()("pack",{slots:{searchParams:Re,body:Pe},run:(e,t)=>{const r={operationName:e.request.operationName,variables:e.request.variables,query:fe(e.request.query)},n=p(e.request.operation)?e.request.operation:e.request.operation.operation,o=e.methodMode,a="post"===o?"post":"read"===me[n]?"get":"post",i=Ae(Ae(Ae({headers:"get"===a?Ve:_e},{headers:e.headers}),e.raw),{headers:e.headers}),s="get"===a?{methodMode:o,...i,method:"get",url:qe(e.url,t.searchParams(r))}:{methodMode:o,...i,method:"post",url:e.url,body:t.body(r)};return{...e,request:s}}}).step("exchange",{slots:{fetch:e=>fetch(e)},run:async(e,t)=>{const r=new Request(e.request.url,e.request),n=await t.fetch(r);return{...e,response:n}}}).step("unpack",{run:async e=>{const t=(e=>{if("object"!=typeof e||null===e)throw Error("Invalid execution result: result is not object");if("errors"in e){if(!Array.isArray(e.errors)||e.errors.some((e=>!(s(e)&&"message"in e&&"string"==typeof e.message))))throw Error("Invalid execution result: errors is not array of formatted errors");e.errors.forEach((e=>{if(!(e=>s(e)&&"message"in e&&"string"==typeof e.message)(e))throw Error("Invalid value in errors array.")}))}if("data"in e&&!s(e.data)&&null!==e.data)throw Error("Invalid execution result: data is not plain object");if("extensions"in e&&!s(e.extensions))throw Error("Invalid execution result: extensions is not plain object");return e})(await e.response.json());return{...e,result:t}}})})}),nt=(ot=Ze($e.States.empty,rt()),t=>{const r=e(ot,t??{});return et(r)})();var ot;console.log(nt);
